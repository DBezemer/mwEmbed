<!DOCTYPE HTML>
<html>
	<head>
		<title>Akamai Media Analytics</title>
		
		<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
		<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
		<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
		<script type="text/javascript" src="../../../resources/jquery/jquery.cookie.js"></script>
		
		<!-- qunit-kaltura must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
		<script type="text/javascript" src="../../KalturaSupport/tests/resources/qunit-kaltura-bootstrap.js"></script>
		
		<script type="text/javascript">		
			function jsKalturaPlayerTest( videoId ) {
				module( "Akamai Media Analytics Plugin Test" );
				var kdp = $( '#kaltura_player' )[ 0 ];
				
				test( "Akamai Configuration Path And Cookies Are Set", function() {
					ok( window.AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH, "Configuration File Path Is Set" );
					kdp.addJsListener( 'doPlay.playingCountTest', 'playCountCallback' );
					kdp.sendNotification( 'doPlay' );
				} );

				window[ 'playCountCallback' ] = function() {
					test( "Required Cookies Are Set", function() {
						stop();
						setTimeout( function() {
							ok( $.cookie( 'AkamaiAnalytics_BrowserSessionId' ).length, "AkamaiAnalytics_BrowserSessionId Cookie Is Set" );
							kdp.sendNotification( 'doPause' );
							equals( parseInt( $.cookie( 'HTML_isPlayingCount' ) ), 1, "HTML_isPlayingCount Is Incremented By 1" );
							start();
							kdp.removeJsListener( 'doPlay.playingCountTest', 'playCountCallback' );
						}, 2000 );
					} );
				}
			}
		</script>

	</head>

	<body>
		<h2> Akamai Media Analytics Test </h2>
		<div id="player_container" style="float:left;" >
			<div id="kaltura_player" style="width:400px;height:260px"></div>
			<script>
				kWidget.featureConfig({
					'targetId' : 'kaltura_player',
					'wid' : '_929011',
					'uiconf_id' : '10660391',
					'entry_id' : '1_m8whjecj',
					'flashvars' : {
						'akamaiMediaAnalytics' : {
							'plugin' : true,
							'swfPath' : 'http://79423.analytics.edgesuite.net/csma/plugin/csma.swf',
							'configPath' : 'http://ma193-r.analytics.edgesuite.net/config/beacon-3431.xml'
						}
					}
				});
			</script>
		</div>
	</body>

</html>
