<!DOCTYPE html>
<html>
<head>
	<style type="text/css">
		@import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700);
		body {
			font-family: "Droid Serif", serif;
			color: #444;
			line-height: 150%;
			border: 0px;
			margin: 0px;
			width: 100%;
			height: 100%;
			overflow: hidden !important;
		}
		video {
			visibility: hidden;
		}
		#logo {
			position: absolute;
			width: 100%;
			height: 100%;
			background-image: url('kalturalogo.png');
			background-repeat: no-repeat;
			background-attachment: fixed;
			background-position: center;
			display: none;
			z-index: 1;
			-webkit-transition: opacity 3s ease-in-out;
			-moz-transition: opacity 3s ease-in-out;
			-ms-transition: opacity 3s ease-in-out;
			-o-transition: opacity 3s ease-in-out;
			opacity: 1;
		}
	</style>
	<script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
	<script src="http://www.kaltura.com/html5/html5lib/v2.33/mwEmbedLoader.php"></script>
</head>
<body>

<div id="kaltura_player" style="top: 10px; right: 10px; left: 10px; bottom: 10px; position: absolute"></div>
<video id="vid"></video>
<div id="logo"></div>

<script type="text/javascript">
	window.onload = function() {
		cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG);

		window.mediaElement = document.getElementById("vid");
		window.mediaManager = new cast.receiver.MediaManager(window.mediaElement);
		window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
		window.messageBus = window.castReceiverManager.getCastMessageBus('urn:x-cast:com.kaltura.cast.player');

		window.messageBus.onMessage = function(event) {
			console.log('### Message Bus - Media Message: ' + JSON.stringify(event));
			var payload = JSON.parse(event['data']);
			if (payload['type'] === 'embed') {

				var publisherID = payload['publisherID'];
				var uiconfID = payload['uiconfID'];
				var entryID = payload['entryID'];

				mw.setConfig("EmbedPlayer.HidePosterOnStart", true);
				kWidget.embed({
					"targetId": "kaltura_player",
					"wid": "_" + publisherID,
					"uiconf_id": uiconfID,
					"readyCallback": function( playerId ){
						var kdp = document.getElementById( playerId );
						var iframe = kdp.getElementsByTagName("iframe");
						var innerDoc = iframe[0].contentDocument || iframe.contentWindow.document;
						var vid = innerDoc.getElementsByTagName("video")[0];
						window.mediaElement = vid;
						window.mediaManager = new cast.receiver.MediaManager(window.mediaElement);
						window.messageBus.broadcast("readyForMedia");
						kdp.sendNotification("doPlay");
						kdp.sendNotification("doPause");
					},
					"flashvars": {
						'controlBarContainer': {
							'plugin': true,
							"hover": true
						}
					},
					"cache_st": 1438601385,
					"entry_id": entryID
				});

			}
			if (payload['type'] === 'show') {
				if (payload['target'] === 'logo') {
					document.getElementById('logo').style.display = 'block';
				}
			}
			if (payload['type'] === 'hide') {
				if (payload['target'] === 'logo') {
					document.getElementById('logo').style.opacity = 0;
				}
			}
		}
		castReceiverManager.start({maxInactivity: 60000});
	};
</script>
</body>
</html>