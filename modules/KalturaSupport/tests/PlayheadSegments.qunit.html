<!DOCTYPE HTML>
<html>
<head>
<title>Playhead segments</title>
<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
<script type="text/javascript">	
function jsKalturaPlayerTest( videoId ){
	var kdp = $('#' + videoId )[0];
	// Name this module 
	module( "Playhead segment" );
	asyncTest("Playhead segment", function(){
		window['onPlayerSeekEnd'] = function(){
			addSeekTests();
			setTimeout(function(){
				start();
			},100)
		}
		// check the start time is set
		equal( kdp.evaluate('{video.player.currentTime}'), 0, "Kdp time at startup is zero" );
		equal( kdp.evaluate('{duration}'), 20, "20 second duration for 20 second segment." );
		
		// add seek listener ( seek to 5 seconds and check time is accurate )
		kdp.addJsListener( 'playerSeekEnd', 'onPlayerSeekEnd');
		// after 1 second of playback issue a seek to 10 seconds
		setTimeout(function(){
			kdp.sendNotification('doSeek', 10 );
		}, 1000 );
	});
	
	window['addSeekTests'] = function(){
		asyncTest("Playhead seeks", function(){
			debugger;
			equal( kdp.evaluate('{video.player.currentTime}'), 10, "seek time is 10" );
			// true player time: 
			var $iframe = $( '#' + videoId + '_ifp' ).contents();
			var rawVid = $iframe.find('#myVideoTarget')[0].getPlayerElement();
			equal( rawVid.currentTime, 20, "true video time is 20" );
			start();
		});
	};
}
</script>
<!-- qunit-kaltura must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
<script type="text/javascript" src="resources/qunit-kaltura-bootstrap.js"></script>
</head>
<body>
<h2>Playhead Segment support</h2>
<div id="segmentConfig"></div>
<div id="myVideoTarget" style="width:400px;height:330px;float:left">
</div>

<script>
	var flashvars = { 
		'segment': {
			'plugin': true,
			'timeIn': 10,
			'timeOut': 30
		}
	};
	
	function doEmbedPlayer( fv ){
		kWidget.embed({
			'targetId': 'myVideoTarget',
			'wid': '_243342',
			'uiconf_id' : '2877502',
			'entry_id' : '0_uka1msg4',
			'flashvars': fv
		});
	}
	/* embed with flashvars: */
	doEmbedPlayer(flashvars);
		
	$( '#segmentConfig' ).prettyKalturaConfig(
			'segment', 
			flashvars, 
			function(fv){
				doEmbedPlayer( fv );
			}
	);
</script>
<p><p>
 
</body>
</html>
