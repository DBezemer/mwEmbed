<!DOCTYPE HTML>
<html>
<head>
	<title>Unified bind/unbind methods test</title>
	<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
	<script type="text/javascript" src="../../../mwEmbedLoader.php?debug=true"></script>
	<script type="text/javascript">	
		function jsKalturaPlayerTest( playerId ) {
			window[ 'playCount' ] = 0;
			window[ 'pauseCount' ] = 0;
			// Name this module
			module( "kBind / kUnbind" );
			var kdp = $( '#' + playerId ).get( 0 );
			test( "kBind :: Namespaced event ( doPlay.test ) + Global callback name", function() {
				stop();
				window.doPlayCallback = function() {
					window[ 'playCount' ]++;
					ok( true, "doPlayCallback binded to doPlay.test" );
					start();
				}
				kdp.kBind( "doPlay.test", "doPlayCallback" );
				kdp.sendNotification( "doPlay" );
			} );
			test( "kBind :: Namespaced event ( doPause.test ) + Anonymous function", function() {
				stop();
				kdp.kBind( "doPause.test", function() {
					window[ 'pauseCount' ]++;
					ok( true, "Anonymous function binded to doPause.test" );
					start();
				} );
				setTimeout( function() {
					kdp.sendNotification( "doPause" );
				}, 250 );
			} );
			test( "kUnbind :: Whole Namespace ( .test )", function() {
				stop();
				var currentPauseCount = window[ 'pauseCount' ];
				var currentPlayCount = window[ 'playCount' ];
				kdp.kUnbind( ".test" );
				kdp.sendNotification( "doPlay" );
				equal( currentPlayCount, window[ 'playCount'], "Unbinded doPlay.test (Checking playCount value)" );
				setTimeout( function() {
					kdp.sendNotification( "doPause" );
					equal( currentPauseCount, window[ 'pauseCount'], "Unbinded doPause.test (Checking pauseCount value)" );
					start();
				}, 250 );
			} );
			test( "kBind :: Non-Namespaced Event ( doPlay ) + Global callback name", function() {
				stop();
				window.doPlayCallback = function() {
					window[ 'playCount' ]++;
					ok( true, "doPlayCallback binded to doPlay" );
					start();
				}
				kdp.kBind( "doPlay", "doPlayCallback" );
				kdp.sendNotification( "doPlay" );
			} );
			test( "kBind :: Non-Namespaced Event ( doPause ) + Anonymous function", function() {
				stop();
				kdp.kBind( "doPause", function() {
					window[ 'pauseCount' ]++;
					ok( true, "Anonymous function binded to doPause" );
					start();
				} );
				setTimeout( function() {
					kdp.sendNotification( "doPause" );
				}, 250 );
			} );
			test( "kUnbind :: Eventname ( doPlay / doPause )", function() {
				stop();
				var currentPlayCount = window[ 'playCount' ];
				var currentPauseCount = window[ 'pauseCount' ];		
				kdp.kUnbind( "doPlay" );
				kdp.kUnbind( "doPause" );
				kdp.sendNotification( "doPlay" );
				equal( currentPlayCount, window[ 'playCount'], "Unbinded doPlay (Checking playCount value)" );
				setTimeout( function() {
					kdp.sendNotification( "doPause" );
					equal( currentPauseCount, window[ 'pauseCount'], "Unbinded doPause (Checking pauseCount value)" );
					start();
				}, 250 );
			} );
			test( "kUnbind :: Namespaced event ( doPlay.tounbind )", function() {
				stop();
				kdp.kBind( "doPlay.ns", function() {
					window[ 'playCount' ]++;
				} );
				kdp.kBind( "doPlay.tounbind", function() {
					window[ 'playCount' ] += 9;
				} );
				kdp.sendNotification( "doPlay" );
				var currentPlayCount = window[ 'playCount' ];
				kdp.kUnbind( "doPlay.tounbind" );
				setTimeout( function() {
					kdp.sendNotification( "doPause" );
					setTimeout( function() {
						kdp.sendNotification( "doPlay" );
						kdp.kUnbind( "doPlay.ns" );
						setTimeout( function() {
							kdp.sendNotification( "doPause" );
							equal( ++currentPlayCount, window[ 'playCount'], "Unbinded doPlay.tounbind (Checking playCount value)" );
							start();
						}, 250 );					
					}, 250 );
				}, 250 );
			} );
			test( "kUnbind :: Eventname ( doPlay ) + Non-existing global callback name / namespace", function() {
				stop();
				kdp.kBind( "doPlay", function() {
					window[ 'playCount' ]++;
				} );
				kdp.kUnbind( "doPlay", "wrongName" );
				var currentPlayCount = window[ 'playCount' ];
				kdp.sendNotification( "doPlay" );
				setTimeout( function() {				
					equal( ++currentPlayCount, window[ 'playCount'], "doPlay was not unbound due to a non-existing global callback name (Checking playCount value)" );
					kdp.kUnbind( "doPlay.test" );
					kdp.sendNotification( "doPause" );
					setTimeout( function() {
						kdp.sendNotification( "doPlay" );
						setTimeout( function() {
							equal( ++currentPlayCount, window[ 'playCount'], "doPlay was not unbound due to a non-existing namespace (Checking playCount value)" );
							kdp.kUnbind( "doPlay" );
							kdp.sendNotification( "doPause" );
							start();
						}, 250 );
					}, 250 );
				}, 250 );
			} );
			test( "Chaining both functions", function() {
				stop();
				kdp.kBind( "doPlay.chaining", function() {
					window[ 'playCount' ]++;
				} );
				var currentPlayCount = window[ 'playCount' ];
				kdp.sendNotification( "doPlay" );
				setTimeout( function() {
					equal( ++currentPlayCount, window[ 'playCount'], "Anonymous function binded to doPlay.chaining (Checking playCount value)" );
					kdp.kUnbind( ".chaining" ).kBind( "doPause.chaining", function() {
						window[ 'pauseCount' ]++;
					} );
					var currentPauseCount = window[ 'pauseCount' ];
					kdp.sendNotification( "doPause" );
					setTimeout( function() {
						equal( ++currentPauseCount, window[ 'pauseCount'], "Anonymous function binded to doPause using chained form kUnbind().kBind() (Checking pauseCount value)" );
						equal( currentPlayCount, window[ 'playCount'], "Unbinded .chaining namespace using chained form kUnbind().kBind() (Checking playCount value)" );
						start();
					}, 250 );
				}, 250 );
			} );
		}
	</script>

	<!-- qunit-kaltura must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
	<script type="text/javascript" src="resources/qunit-kaltura-bootstrap.js"></script>
</head>
<body>
	<h2> Unified bind/unbind methods test </h2>
	<a href="?forceMobileHTML5"> Force Mobile HTML5</a> for testing with desktop chrome and safari.
	<br />
	<div id="myVideoTarget" style="width: 400px; height: 330px"></div>

	<script>
		kWidget.embed({
			'targetId': 'myVideoTarget',
			'wid': '_243342',
			'uiconf_id' : '2877502',
			'entry_id' : '0_uka1msg4',
			'flashvars':{
				'externalInterfaceDisabled' : false
			},
			'readyCallback': function( playerId ) {
				console.log( playerId + ' is ready' );
			}
		} );
	</script>
</body>
</html>