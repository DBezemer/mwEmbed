<html>
<head>
<title>Fall forward Iframe</title>
<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>

<script type="text/javascript">		
	mw.setConfig('EmbedPlayer.EnableIpadHTMLControls', true);
	mw.setConfig( 'Kaltura.IframeRewrite', true );
</script>
<script type="text/javascript">	
if( window.QUnit ){
	QUnit.start();	
	module( "IframeFallForward" );
	
	var jsCallbackCalled = false;
	function jsCallbackReady ( videoId ) {
		jsCallbackCalled = true;

		var $iframe = $('#' + videoId + '_ifp').contents();
		var iframeContext = window.frames['kaltura_player_ifp'];
		
		test( "Iframe in DOM", function() {
			ok( $('#' + videoId + '_ifp').length , 'iframe found' );
			equal( typeof iframeContext, 'object', "iframe JavaScript context available" );
		});

		asyncTest("Iframe layout elements", function(){
			// Add an mw.ready here to make sure the interface is ready before we check for interface components
			mw.ready(function(){
				ok( $iframe.find('.play-btn-large').length, ".play-btn-large found" );
				ok( $iframe.find('.play-btn').length, ".play-btn found" );
				start();
			});
		});
		
		asyncTest("Iframe config", function(){
			equal( iframeContext.mw.getConfig('Kaltura.IframeRewrite' ), false, "Kaltura.IframeRewrite" ); 
			equal( iframeContext.mw.getConfig('Mw.LogPrepend'), 'iframe:', "Mw.LogPrepend ");
			start();
		});
		
	}
	
	// We may make this part of the framework.. but kind of tricky given diffrent loading types
	// this really only applies to all kaltura tests... maybe we include it as qunit-kalturasupport.js
	asyncTest( "loading player", function(){
		var waitCount = 0;
		var interval = setInterval(function(){
			// timeout in 20 seconds:
			if( waitCount == 200 && !jsCallbackCalled ){
				ok(false, "Player timed out");
				clearInterval( interval );
			}
			if( jsCallbackCalled ){
				ok(true, "Player loaded");
				clearInterval( interval );
				start();
			}
			waitCount++;
		}, 100);
	});
}
</script>
</head>
<body>
<h2> Fall forward iFrame </h2>
<a href="?forceMobileHTML5"> Force Mobile HTML5</a> for testing with desktop chrome and safari.
<br />
<object id="kaltura_player" name="kaltura_player" type="application/x-shockwave-flash" allowFullScreen="true" allowNetworking="all" allowScriptAccess="always" height="333" width="400" xmlns:dc="http://purl.org/dc/terms/" xmlns:media="http://search.yahoo.com/searchmonkey/media/" rel="media:video" resource="http://www.kaltura.com/index.php/kwidget/cache_st/1292436446/wid/_243342/uiconf_id/2877502/entry_id/0_uka1msg4" data="http://www.kaltura.com/index.php/kwidget/cache_st/1292436446/wid/_243342/uiconf_id/2877502/entry_id/0_uka1msg4"><param name="allowFullScreen" value="true" /><param name="allowNetworking" value="all" /><param name="allowScriptAccess" value="always" /><param name="bgcolor" value="#000000" /><param name="flashVars" value="&" /><param name="movie" value="http://www.kaltura.com/index.php/kwidget/cache_st/1292436446/wid/_243342/uiconf_id/2877502/entry_id/0_uka1msg4" /><a href="http://corp.kaltura.com">video platform</a> <a href="http://corp.kaltura.com/video_platform/video_management">video management</a> <a href="http://corp.kaltura.com/solutions/video_solution">video solutions</a> <a href="http://corp.kaltura.com/video_platform/video_publishing">video player</a> <a rel="media:thumbnail" href="http://cdnbakmi.kaltura.com/p/243342/sp/24334200/thumbnail/entry_id/0_uka1msg4/width/120/height/90/bgcolor/000000/type/2" /> <span property="dc:description" content="" /><span property="media:title" content="FolgersCoffe.mpeg" /> <span property="media:width" content="400" /><span property="media:height" content="333" /> <span property="media:type" content="application/x-shockwave-flash" /> </object>
</body>
</html>