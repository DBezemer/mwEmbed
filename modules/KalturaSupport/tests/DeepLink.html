<!--
	4 Entries
	---------
	1. 0_uka1msg4
	2. 0_swup5zao
	3. 0_ntovmku5
	4. 1_n1nv959k
-->
<!DOCTYPE HTML>
<html>
	<head>
	    <title>Single playlist deep-linking example</title>
		<script type="text/javascript" src="http://cdnbakmi.kaltura.com/html5/html5lib/v1.6.10.5/mwEmbedLoader.php"></script>
		<script type="text/javascript">
			// a reference to the player
			var mykdp;
			
			var changedEntry = false;
			
			// register notifications callbacks
			function jsCallbackReady () {
				mykdp = document.getElementById("kaltura_player");
				mykdp.addJsListener("changeMedia", "changeMediaHandler");
				mykdp.addJsListener("playlistReady", "playlistReadyHandler");
				//mykdp.addJsListener("kdpReady", "kdpReadyHandler");
			}
				
			// save entry id to the querystring
			function changeMediaHandler(data, id) {
				if (data.entryId != undefined && data.entryId != null) {
					if ( changedEntry ) {
						location.hash = "entryid=" + data.entryId;
					}
					else {
						changedEntry = true;
					}
				} 
			}
			
			// if have hash data use it, otherwise start playing normally
			function playlistReadyHandler(data, id) {
				mykdp.setKDPAttribute('playlistAPI', 'autoInsert', 'true');
				//var aaa = mykdp.evaluate('{playlistAPI.autoInsert}');
				if (location.hash) {
					// get the dataprovider, find the index of the given entryid and select it.
					// get the entryid to play (assume more than one parameter after the #):
					var str = location.hash;
					// remove # sign
					str = str.substring(1, str.length); 
					var arr = str.split("&");
					var entryid;
					// find the relevant key and save the value
					for (var i = 0; i<arr.length; i++) {
						var arr2 = arr[i].split("=");
						if (arr2[0] == "entryid") {
							entryid = arr2[1];
							break;
					  	}
					} 
					// find the index of the matching entry in the list:
					var content = mykdp.evaluate('{playlistAPI.dataProvider.content}');
					var l = content.length;
					for (var i = l-1; i>=0; i--) {
						if (content[i].entryId == entryid || content[i].id == entryid) {
							break;
						}
					}
					// if the entry wasn't found, get the first entry.
					if (i == -1) i = 0;
					
					// start playing the i'th entry in the playlist.
					mykdp.setKDPAttribute('playlistAPI.dataProvider', 'selectedIndex', i);
				}
				else {
					// play the first element on the list.
					mykdp.setKDPAttribute('playlistAPI.dataProvider', 'selectedIndex', '0');
				}
				mykdp.removeJsListener("changeMedia", "changeMediaHandler");
				mykdp.removeJsListener("playlistReady", "playlistReadyHandler");
			}	
		</script>

    </head>
	<body>
		<h3> Single playlist deep-linking example </h3> 
		<!-- 0_ntovmku5 - 3rd Entry -->
		<a href="?forceMobileHTML5"> Force Mobile HTML5</a>
		<br /> <br />
		<object id="kaltura_player" 
				name="kaltura_player_1319935596" 
				type="application/x-shockwave-flash" 
				allowFullScreen="true" 
				allowNetworking="all" 
				allowScriptAccess="always" 
				height="620" 
				width="400" 
				bgcolor="#000000" 
				xmlns:dc="http://purl.org/dc/terms/" 
				xmlns:media="http://search.yahoo.com/searchmonkey/media/" 
				rel="media:video" 
				resource="http://www.kaltura.com/index.php/kwidget/cache_st/1319935596/wid/_243342/uiconf_id/5783651" 
				data="http://www.kaltura.com/index.php/kwidget/cache_st/1319935596/wid/_243342/uiconf_id/5783651">
			<param name="allowFullScreen" value="true" />
			<param name="allowNetworking" value="all" />
			<param name="allowScriptAccess" value="always" />
			<param name="bgcolor" value="#000000" />
			<param name="flashvars" value="&" />
			<param name="movie" value="http://www.kaltura.com/index.php/kwidget/cache_st/1319935596/wid/_243342/uiconf_id/5783651" />
		</object>
	</body>
</html>
