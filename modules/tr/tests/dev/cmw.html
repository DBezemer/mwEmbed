<!doctype>
<html>
<head>
    <title>Reuters Insider</title>
    <script type="text/javascript" src="../../../../mwEmbedLoader.php"></script>
    <style>
        body{
            margin: 0;
        }

    </style>
</head>
<body>
<div class="container" style="width: 100%; height: 100%;">
    <div id="kPlayer" style="width: 100%;; height:100%; float: left"></div>
</div>
<script>


    //parse query string to an object
    var queryString = function () {
        var query_string = {};
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            // If first entry with this name
            if (typeof query_string[pair[0]] === "undefined") {
                query_string[pair[0]] = pair[1];
                // If second entry with this name
            } else if (typeof query_string[pair[0]] === "string") {
                var arr = [ query_string[pair[0]], pair[1] ];
                query_string[pair[0]] = arr;
                // If third or later entry with this name
            } else {
                query_string[pair[0]].push(pair[1]);
            }
        }
        return query_string;
    } ();


    var entryId = "";
    var uiconfId = 29393161 ; //this will come from KMS 27493391 28529602 29008071 29277301(TR)
    var partnerId= 1851191;
    var clipsToShow = 4; //amount of videos to show in playlist
    var omniturePn = "";
    var omnitureEud = "";
    var omnitureUuid = "";
    var widgetType = "";
    var playlistId = "";
    var startFrom = 0;



    var hashStr = window.location.hash.substring(1);
    var jsonConfig = {};
    try {
        jsonConfig = JSON.parse(hashStr);
    } catch( e ) {
        kWidget.log('TR: Unable to parse JSON from location.hash');
    }

    if(jsonConfig.pid) {
        partnerId = jsonConfig.pid;
    }
    if(jsonConfig.cid){
        playlistId = jsonConfig.cid;
    }
    if(jsonConfig.mid) {
        entryId = jsonConfig.mid;
    }
    widgetType = jsonConfig.wtype;
    if(jsonConfig.startFrom){
        startFrom = jsonConfig.startFrom;
    }

    if(jsonConfig.uiconfId){
        uiconfId = jsonConfig.uiconfId;
    }
    if(jsonConfig.clipsToShow){
        clipsToShow = jsonConfig.clipsToShow;
    }
    //      example of override using mid (entry)
    //      http://localhost/html5.kaltura/mwEmbed/modules/tr/tests/dev/cmw.html?#{"mid":"1_e11zckox","startFrom":0,"uuid":"omnitureUser","pn":"pmniturePn","bitrate":400,"eud":"omnitureEud","wtype":"omnitureWtype"}
    //      example of override using cid (playlist)
    //      http://localhost/html5.kaltura/mwEmbed/modules/tr/tests/dev/cmw.html?#{"cid":"1_gnb3yw1a","startFrom":0,"uuid":"omnitureUser","pn":"pmniturePn","bitrate":400,"eud":"omnitureEud","wtype":"omnitureWtype"}
    mw.setConfig('forceMobileHTML5', true);


    var embedJSON = {
        'targetId': 'kPlayer',
        'wid': '_'+partnerId,
        'uiconf_id' : uiconfId,
//        'entry_id' : "1_ir11bloa",
        'flashvars': {
            'confFilePath': '{libPath}/modules/tr/resources/trjson.json'
        ,'playlistAPI': {
            'autoPlay' : 'true',
            'showControls': false,
            'includeHeader': false,
            'hideClipPoster': true,
            'renderWhenEmpty': true,
            'templatePath': '../tr/templates/playlist.tmpl.html',
            'paging': true,
            'MinClips': clipsToShow,
            'pageSize': 8,
            'mediaItemHeight': 200,
            'horizontalScrollItems' : clipsToShow
        },

            'trPlaylistServices': {
                'plugin': true
            }


        }
    }

    if(entryId && playlistId){
        //selece entry
        embedJSON.entry_id = entryId;
    } else if (entryId){
        embedJSON.entry_id = entryId;
    } else {
        embedJSON.flashvars.playlistAPI.kpl0Id = playlistId;
    }

    kWidget.embed(embedJSON);

</script>
</body>
</html>
