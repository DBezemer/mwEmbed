<!DOCTYPE HTML>
<html>
<head>
	
	<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />

	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
	<script type="text/javascript" src="http://staging.html5video.org/testswarm/js/inject.js"></script>

<script>

var $$ = jQuery.noConflict(true);
var $ = jQuery = null; // will always run the tested page's jquery from $
var mw = null; // we will be grabbing the mw from the iframe

var testLocation = "../../modules/EmbedPlayer/tests/Player_Sources.html";

var playbackStarted = false;

QUnit.config.autostart = false;

function runTests() {

	module("Embed Player Loads");

		test("embed player is embedded", function() {
			ok( $('.mv-player', '.mwplayer_interface' ) );
		});

		test("embed player is skinned", function() {
			ok( $('.play-btn-large') );
		});

	module("Embed Player Plays");

		asyncTest("play button clicked", function() {
			setTimeout( function()
			{ 
				var player = $('#vid1').get(0);
				$( player ).bind( 'play', function(){ playbackStarted = true });
				ok( $('.play-btn-large').click() );
				start();
			}, 5000);
		});

		asyncTest("playback began", function() {
			setTimeout( function()
			{ 
				ok( playbackStarted == true );
				start();
			}, 10000);
		});
}

$$(window).load(function(){

	$$('#testFrame').attr('src', testLocation)
	
	$$('#testFrame').load(function () {
		mw = window.frames[0].mw;
		mw.ready(function(){
			//grab jQuery from inside the document
			$ = jQuery = window.frames[0].$j;
			QUnit.start();
			runTests();
		});
	});
});

</script>
</head>
<body>
	<h1 id="qunit-header">QUnit example</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
	<div style="float: left"> 
		<iframe height="700" width="1000" id="testFrame"></iframe> 
	</div> 
</body>
</html>
