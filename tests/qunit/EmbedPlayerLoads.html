<!DOCTYPE HTML>
<html>
<head>
	
	<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />

	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
	<script type="text/javascript" src="http://staging.html5video.org/testswarm/js/inject.js"></script>
	<!--[if IE]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

<script>

var $$ = jQuery.noConflict(true);
var $ = jQuery = null; // will always run the tested page's jquery from $
var mw = null; // we will be grabbing the mw from the iframe

var testLocation = "../../modules/EmbedPlayer/tests/Player_Sources.html";

var playbackStarted = false;

QUnit.config.autostart = false;

function runTests() {

	module("Embed Player Loads");

		test("embed player is embedded", function() {
			ok( $('.mv-player', '.mwplayer_interface' ) );
		});

		test("embed player is skinned", function() {
			ok( $('.play-btn-large') );
		});

	module("Embed Player Plays");

		asyncTest("play button clicked", function() {
			setTimeout( function()
			{ 
				var player = $('#vid1').get(0);
				$( player ).bind( 'play', function(){ playbackStarted = true });
				ok( $('.play-btn-large').click() );
				start();
			}, 5000);
		});

		asyncTest("playback began", function() {
			setTimeout( function()
			{ 
				ok( playbackStarted == true );
				start();
			}, 10000);
		});
}


$$(document).ready(function(){
	$$(document.body).prepend('<iframe name="testFrame" id="testFrame" src="'+testLocation+'" width="100%" height="300px" border="none">');
	//autoResize('testFrame');
	
	$$('#testFrame').load(function () {
		setTimeout( function(){
			mw = window.frames["testFrame"].mw;
			mw.ready(function(){
				//grab jQuery from inside the document
				$ = jQuery = window.frames["testFrame"].$j;
				QUnit.start();
				runTests();
			});
		}, 5000);
	});
});

</script>
</head>
<body>
	<h1 id="qunit-header">QUnit example</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
